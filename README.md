# ascii-phonons

Visualisation of crystal vibrations with Blender.

Visualisation is a powerful tool for the study of vibrations in the solid state.
"Semi-automatic" animations have been generated for scientific publications, where they provide insight to spectroscopic observations.\[[1][Skelton2015],[2][Brivio2015]\] (Images [1](http://dx.doi.org/10.1063/1.4917044.1), [2](http://people.bath.ac.uk/aw558/temp/mapi_phonon.gif).) In order to make this type of imagery more accessible, and add some visual interest to [ajjackson](https://github.com/ajjackson)'s PhD thesis, a more convenient and automatic toolchain is desirable.

Please use the [issue tracker](https://github.com/ajjackson/ascii-phonons/issues) for feature requests, bug reports and more general questions.

![](images/comof_phonon.gif)

## Features

* Import atomic positions, unit cell and phonon modes from `.ascii` files
* Use open-source graphics package Blender to render images; the end-user is not required to interact with the Blender GUI unless they want to
* Create static or animated images showing the unit cell bounding box, atomic positions and mass-weighted eigenvectors
* Use ImageMagick to export .gif files for use in web browser
* Display arbitrary supercell size defined by three counting numbers. The displayed bounding box may be shifted within this structure.
* Animated images include mass-weighted movements of atoms, which include the phase shift in different unit cells
* Arrows indicating mass-weighted eigenvectors do *not* include phase information
* An attractive "cartoon-like" visual style with flat colours and outlines
* Atom colours are assigned from a default or user config file. If undefined, a random colour is selected.

## Development

The target for input files is the ASCII format used by [v_sim](http://inac.cea.fr/L_Sim/V_Sim/), a useful program and currently one of the only tools available for visualising phonons. These files contain all the information needed to define a crystal sructure and its vibrations. It is presumed that these are generated by [Phonopy](http://phonopy.sourceforge.net/) from *ab initio* electronic structure calculations, and initially this code will only target the features used by Phonopy. Extension to the full ASCII format is of course welcome.
Animation and rendering will be done in [Blender](http://www.blender.org/).
The preferred approach to Blender is to write an "add-on" which carries out importing duties.

Developing Blender add-ons can be a bit clunky as one is required to
mess around with the GUI when testing changes, so there may be some
hackery to get around this.  Building Blender as a Python library
would ease development considerably, but appears to be quite difficult
to do on a Mac.

The target platforms are modern GNU/Linux distributions and Mac OS X. Windows support is seen as faintly desirable, but would impede the initial development process.

## Setup

The simplest way to set up this code at the moment is

1. Download the code with `git clone git@github.com:ajjackson/ascii-phonons`
2. Setup pyyaml for Blender's python3
    - On a Debian or Ubuntu system with sudo privileges, just `apt-get install python3-yaml`.
    - Otherwise, get pyyaml from http://pyyaml.org and create a simlink to the modules directory in this code with `ln -s /path/to/pyyaml/lib3/yaml /path/to/ascii-phonons/modules/`.
      You can get faster performance by building with the bindings to libyaml, which is written in C, but this isn't necessary for the simple YAML files used in this project.
    
Eventually this will be implemented as a proper Blender add-on, and users will need to follow the Blender procedure for installing from a .zip file.
In the mean time, the wrapper script sets the paths for you.

## Using the wrapper script

At the moment the most sane way to work with this is to use the wrapper **scripts/blend_ascii.py** in a Bash shell. Call the script with

    python blend_ascii.py -h

for information about the numerous command-line arguments.

If working on Mac OS X, you may need to specify the path to your Blender binary, which is tucked away in a .app package, using the `-b` flag.
However, the script assumes you have Blender installed in a folder called "Blender" in the root Applications folder, and should find your binary in this case.

A typical call to the wrapper script would be something like:

    python blend_ascii.py /path/to/my/phonons.ascii -m 5 --static --vectors -o pretty

which should write a static image **pretty.png**, illustrating mode 5 with arrows.
To generate an animation, try

    python blend_ascii.py /path/to/my/phonons.ascii -m 1 --gif -o pretty

which will use Imagemagick to generate **pretty.gif**.

## Requirements

- Some means of generating .ascii files. We like [Phonopy](http://phonopy.sourceforge.net).
- A recent version of Blender; development is currently with
  Blender 2.73 and later, although some effort exists to preserve compatibility with earlier versions.
  [Ubuntu repositories are often quite far behind...]
- A Python 3-compatible and Blender-accesible version of pyyaml.
- [Imagemagick](http://www.imagemagick.org) tools (specifically "convert" and "montage") are used for image conversion and tiling.
  This is available in most package managers and may even be pre-installed with your Unix-like operating system.

## Implementation details

The default atomic radii are the covalent radii from [Cordero *et al* (2008)][Cordero2008].
The eigenvectors are scaled by the square root of the relative atomic mass; the atomic mass data is from [Coursey *et al.* (2015)][Coursey2015].

## License

GNU GPL v3

## Disclaimer

Use at your own risk. This project is not affiliated with Blender, Phonopy or v_sim.

[Skelton2015]: http://dx.doi.org/10.1063/1.4917044 "Jonathan M. Skelton, Adam J. Jackson, Mirjana Dimitrievska, Suzanne K. Wallace and Aton Walsh (2015), *APL Mat.* **3**, 041102"
[Brivio2015]: http://dx.doi.org/10.1103/PhysRevB.92.144308 "Federico Brivio, Jarvist M. Frost, Jonathan M. Skelton, Adam J. Jackson, Oliver J. Weber, Mark T. Weller, Alejandro R. Goñi, Aurélien M. A. Leguy, Piers R. F. Barnes, and Aron Walsh (2015), *Phys. Rev. B* **92**, 144308"
[Cordero2008]: http://dx.doi.org/10.1039/B801115J "Beatriz Cordero, Verónica Gómez, Ana E. Platero-Prats, Marc Revés, Jorge Echeverría, Eduard Cremades, Flavia Barragána and Santiago Alvarez (2008), *Dalton Trans.* 2832-2838"
[Coursey2015]: http://physics.nist.gov/Comp "Coursey, J.S., Schwab, D.J., Tsai, J.J., and Dragoset, R.A. (2015), Atomic Weights and Isotopic Compositions (version 4.1). [Online] Available: http://physics.nist.gov/Comp [2015-10-25]. National Institute of Standards and Technology, Gaithersburg, MD."
